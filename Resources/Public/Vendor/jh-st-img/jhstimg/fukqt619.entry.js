/*! Built with http://stenciljs.com */
const{h:t}=window.jhstimg;class e{constructor(){this._isHandleImageFallback=!1,this._sources=[]}srcWatchHandler(){this.addIntersectionObserver()}srcsetWatchHandler(){this.addIntersectionObserver()}sourcesWatchHandler(){this.addIntersectionObserver()}documentScrollHandler(){this._isHandleImageFallback&&this.fallbackLazyLoad()}windowResizeHandler(){this._isHandleImageFallback&&this.fallbackLazyLoad()}windowRrientationchangeHandler(){this._isHandleImageFallback&&this.fallbackLazyLoad()}componentWillLoad(){this._hasIntersectionObserver="IntersectionObserver"in window}componentDidLoad(){this.addIntersectionObserver()}componentDidUnload(){this.removeIntersectionObserver()}handleImage(){this._sources=this.sources?"string"==typeof this.sources?JSON.parse(this.sources):this.sources:[],this._hasIntersectionObserver?setTimeout(()=>{const t=this.el.querySelector("img");t.getAttribute("data-src")&&(t.setAttribute("src",t.getAttribute("data-src")),t.removeAttribute("data-src")),t.getAttribute("data-srcset")&&(t.setAttribute("srcset",t.getAttribute("data-srcset")),t.removeAttribute("data-srcset"))},0===this._sources.length?0:300):(this._isHandleImageFallback=!0,this.fallbackLazyLoad())}fallbackLazyLoad(){const t=this.el.querySelector("img");t.getBoundingClientRect().top<=window.innerHeight&&t.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(t).display&&(t.getAttribute("data-src")&&(t.setAttribute("src",t.getAttribute("data-src")),t.removeAttribute("data-src")),t.getAttribute("data-srcset")&&(t.setAttribute("srcset",t.getAttribute("data-srcset")),t.removeAttribute("data-srcset")))}addIntersectionObserver(){(this.src||this.srcset)&&(this._hasIntersectionObserver?(this.removeIntersectionObserver(),this.io=new IntersectionObserver(t=>{t[0].isIntersecting&&(this.handleImage(),this.removeIntersectionObserver())}),this.io.observe(this.el.querySelector("img"))):this.handleImage())}removeIntersectionObserver(){this.io&&(this.io.disconnect(),this.io=null)}render(){return this._sources.length?t("picture",null,this._sources.map(e=>t("source",{sizes:e.sizes,srcSet:e.srcset,type:e.type,media:e.media})),t("img",{"data-src":this.src,"data-srcset":this.srcset,alt:this.alt,class:this.imgClass})):t("img",{"data-src":this.src,"data-srcset":this.srcset,alt:this.alt,class:this.imgClass})}static get is(){return"jh-st-img"}static get properties(){return{_hasIntersectionObserver:{state:!0},_isHandleImageFallback:{state:!0},_sources:{state:!0},alt:{type:String,attr:"alt"},el:{elementRef:!0},imgClass:{type:String,attr:"img-class"},sources:{type:"Any",attr:"sources",watchCallbacks:["sourcesWatchHandler"]},src:{type:String,attr:"src",watchCallbacks:["srcWatchHandler"]},srcset:{type:String,attr:"srcset",watchCallbacks:["srcsetWatchHandler"]}}}static get listeners(){return[{name:"document:scroll",method:"documentScrollHandler",passive:!0},{name:"window:resize",method:"windowResizeHandler",passive:!0},{name:"window:orientationchange",method:"windowRrientationchangeHandler"}]}static get style(){return"jh-st-img{display:block}jh-st-img img{max-width:100%;max-height:100%}"}}export{e as JhStImg};